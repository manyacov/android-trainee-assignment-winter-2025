# Avito Audio Player App

## MVP

---

Музыкальное приложение для воиспроизведения треков локально и через API с возможностью поиска.

**Реализованный функционал**

- Поиск треков через открытую API
- Воиспроизведение найденных треков
- Управление проигрыванием (пауза, продолжение, следующая/предыдущая песня) как на экране воиспроихводимого трека, так и через уведомление
- Воиспроизведение локальной музыки и поиск по ней

## Технологии

---

- **Языки:** Kotlin
- **Архитектура:** MVI, Clean Architecture
- **UI:** Jetpack Compose
- **DI:** Hilt
- **Медиа:** Media3 ExoPlayer, Coil
- **Асинхронность:** Coroutines/Flow
- **Работа с сетью:** Retrofit + OkHttp
- **Хранение данных:** Room, DataStore

## API

---

[Deezer API](https://developers.deezer.com/login?redirect=/api)

## Требования и сборка

---

**Минимальная версия Android — 10 (API 29)**

**Минимальная версия Android Studio для сборки Ladybug | 2024.2.1**

**Минимальная версия JVM runtime — 11**

**После скачивания проекта, откройте его в Android Studio и в командной строке вызовите:**

`./gradlew assembleDebug`

**После успешной сборки заберите файл проекта в …AvitoPlayer\app\build\outputs\apk\debug\app-debug.apk**

❗**Для удобства пользования предоставьте при первом запросе все разрешения**

## О самом задании

---

Задание-спецификация написано в очень кратком стиле, посмотреть его можно [здесь](https://github.com/avito-tech/tech-internship/blob/main/Tech%20Internships/Android/Android-trainee-assignment-winter-2025/Android-trainee-assignment-winter-2025.md). И так как по выданному заданию, я не могла уточнить некоторые нюансы во время его выполнения у аналитиков или архитекторов, какое именно ожидаемое поведение, как это могло бы быть на настоящей работе. Поэтому мне пришлось, самой продумать некоторые решения “пробелов”. Ниже я распишу, что реализовала или наоборот не реализовала, и почему выбрала то или иное решение.

**Основные ветки разработки:**

- [Downloaded tracks part](https://github.com/manyacov/android-trainee-assignment-winter-2025/tree/feature-hilt/downloaded-screen)
- [Api tracks screen](https://github.com/manyacov/android-trainee-assignment-winter-2025/tree/feature-hilt/api-screen)
- [Player set up screen](https://github.com/manyacov/android-trainee-assignment-winter-2025/tree/feature-hilt/play-screen-settings)

## Вопросы и решения

---

1. **Пагинация**
    1. для локальных треков в MVP-версии приложения не увидела необходимости её реализовывать, т.к. в данный момент большая часть пользователей предпочитает слушать онлайн и мне кажется, что пагинация для локальных треков — излишество и нарушение юзабилити
    2. для треков, получаемых по API, пагинация была реализована
2. **Список проигрываемых треков по API**
    1. на экране chart - мы берем список треков только из загруженной части чарта. Т.е если загружена первая страница чарта - берем только ее, если две страницы чарта - то обе.
    2. на экране поиска треков - аналогично, мы берем список треков только из полученных из поиска треков, при этом из загруженной части по страницам треков. Т.е. если загружена первая страница поиска, то мы перемещаемся при открытии произведения трека только по ней, если загружено две-три страницы - то в случае проигрывания, перемещаемся по этим всем двум-трем страницам.
3. **Курсор проигрываемых треков** 
    1. **по API -** для треков получаемых по API я реализовала при открытии экрана проигрывания трека, параллельную загрузку еще 2х треков с каждой стороны, и при переключении на следующий-предыдущий трек дозагрузку еще одного трека в кеш ExoPlayer, выполняя смещение на один трек в нужную сторону. Т.е. всегда в проигрываемом плейлисте держим только 5 треков, подгружая при необходимости новые, кроме “краевых” случаев.
    2. Для локальных треков сразу загружаю весь список треков, т.к. в этом конкретном случае это не требует лишних запросов к серваку (и как мы помним, треков у нас не так много в большинстве случаев).
4. Запрос **получения треков** ([https://api.deezer.com/chart](https://api.deezer.com/chart)) из чарта, я заменила на [https://api.deezer.com/chart/0/tracks](https://api.deezer.com/chart/0/tracks), т.к. в задании мы работаем только с треками, а получать альбомы и исполнителей нет необходимости (не указано в условии).
5. Аналогично я слегка изменила и **запрос поиска** на [https://api.deezer.com/search?q=track:{query}](https://www.notion.so/http-80-https-443-144a2069533380c3bc70e5825f7d6d27?pvs=21), чтобы он выполнялся только по трекам.
6. **Выбран Hilt** как DI вместо Dagger2, т.к. реализация провайдинга зависимостей требует более изощрённого подхода при использовании Jetpack Compose.

## Известные ошибки и необходимые доработки

---

- Отображение в списках треков воиспроизводимого в данный момент трека, управление в данный момент при выходе с экрана с плеером доступно только в шторке уведомлений
- Задержка, при переключении треков между началом игры музыки и отображением обложки
- Возможны ошибки, при быстром переключении треков по API, тут, возможно, можно было бы это исправить, исправив проблему выше и добавив заодно небольшую задержку или блокируя возможность нажатия кнопок переключения треков до “полного” переключения
- Обработка отсутствия интернета
- Другие исключительные ситуации (доработка многопоточности)

**Доработки:**

- В спеке не было указана необходимость взаимосвязи между экраном списка треков и экраном воиспроизведения, поэтому в данный момент управление при выходе с экрана плеера доступно только в шторке уведомления. Взаимосвязь, считаю, нужно будет добавить.
- Доработки по подгрузке через Notifications.
- Dagger, его реализация довольно неприятна с Jetpack Compose. В начале разработки были попытки его добавить. В данный момент можно переписать, добавив провайдинг необходимых зависимостей через CompositionLocal.
- Чистка кода.
